define("douRadio/popup/1.0.0/main",["$","backbone","./models/player","./view/popup","underscore","./share","./view/channels"],function(a){var b,c,d=a("$"),e=(a("backbone"),a("./models/player")),f=a("./view/popup"),g=a("./view/channels"),h=chrome.extension.connect({name:"douRadio"});h.onMessage.addListener(function(a){if("init"==a.type){b=new e(a.obj),c=new f({model:b}),c.port=h;var i=new g;i.port=h,i.player=b}"songChanged"==a.type&&b.set({currentSong:a.obj}),"songListLoading"==a.type&&(b.set({loadType:a.obj}),b.set({loading:!0})),"songListLoaded"==a.type&&(b.set({loadType:a.obj}),b.set({loading:!1})),"playing"==a.type&&b.set({time:a.obj}),"login"==a.type&&d("#notify").show()}),d("#notify_close").on("click",function(){d("#notify").hide()})}),define("douRadio/popup/1.0.0/models/player",["backbone"],function(a,b,c){var d=a("backbone"),e=d.Model.extend({});c.exports=e}),define("douRadio/popup/1.0.0/view/popup",["backbone","$","underscore","douRadio/popup/1.0.0/share","douRadio/popup/1.0.0/view/channels"],function(a,b,c){var d,e,f,g;d=a("backbone"),e=a("$"),f=a("underscore"),g=a("douRadio/popup/1.0.0/share");a("douRadio/popup/1.0.0/view/channels");PopupView=d.View.extend({el:"#main",template:f.template(e("#t_songInfo").html()),events:{"click #control a":"play","click #skip":"skip","click #like":"like","click #delete":"deleteSong","click #search":"showChannels","mouseover #control":"fadeOutCD","mouseout #control":"fadeInCD","mouseover #share":"showShareList","mouseout  #share":"hideShareList","click #shareList a":"share","click #replay":"replay","input #range":"volume"},initialize:function(){this.render(),this.listenTo(this.model,"change:currentSong",this.changeSong),this.listenTo(this.model,"change:time",this.playing),this.listenTo(this.model,"change:loading",this.loading)},render:function(){var a=this.template(this.model.attributes);this.$el.html(a),this.playing()},realModel:function(){return this.model.attributes},play:function(){var a=this.model.get("playing");this.model.set({playing:!a}),this.port.postMessage({type:"togglePlay"}),a?(e("#control a").attr("class","button paused"),e("#cover").addClass("fadeout").removeClass("rotating")):(e("#control a").attr("class","button playing"),e("#cover").removeClass("fadeout").addClass("rotating"))},skip:function(){this.model.get("playing")&&this.port.postMessage({type:"skip"})},like:function(){this.model.get("playing")&&this.port.postMessage({type:"toggleLike"}),this.model.get("playing")&&e("#like").toggleClass("like").toggleClass("unlike")},deleteSong:function(){this.model.get("playing")&&this.port.postMessage({type:"delete"})},changeSong:function(){var a=this.model.get("currentSong"),b=a.picture,c=e("#cover"),d=this;c.fadeOut("150",function(){var a=new Image;a.src=b,e(a).load(function(){d.model.get("playing")&&c.removeClass("fadeout").addClass("rotating"),c.css("background-image","url("+b+")"),c.fadeIn("350")})}),e("#title").html(a.title).attr("title",a.title),e("#artist").html(a.artist+"--"+a.albumtitle).attr("title",a.artist+"--"+a.albumtitle).attr("href","http://music.douban.com"+a.album),e("#like").attr("class",1==a.like?"button like":"button unlike")},playing:function(){var a=this.model.get("time"),b=a.duration-a.currentTime,c=parseInt(b/60),d=parseInt(b%60);d=10>d?"0"+d:d,e("#timer").html(c+":"+d),e("#played").width(a.currentTime/a.duration*100+"%")},fadeOutCD:function(){e("#control a").hasClass("playing")&&(e("#cover").addClass("fadeout"),e("#control a").show())},fadeInCD:function(){e("#control a").hasClass("playing")&&(e("#cover").removeClass("fadeout"),e("#control a").hide())},showShareList:function(){e("#shareList").show()},hideShareList:function(){e("#shareList").hide()},share:function(a){g[e(a.target).attr("id")](this.model.get("currentSong"))},loading:function(){var a=e("#operation li[op='"+this.model.get("loadType")+"']");this.model.get("loading")?(a.removeClass("rotated").addClass("rotate").addClass("rotating"),"r"!=this.model.get("loadType")&&"u"!=this.model.get("loadType")&&e("#cover").addClass("fadeout").removeClass("rotating")):e("#operation li").removeClass("rotate").removeClass("rotating")},replay:function(){var a=this.model.get("isReplay");this.model.set({isReplay:!a}),a?e("#replay").addClass("hover-fadeIn"):e("#replay").removeClass("hover-fadeIn"),this.port.postMessage({type:"toggleReplay"})},volume:function(a){this.port.postMessage({type:"changeVolume",value:a.target.value/100})},showChannels:function(){"true"==e("#search").attr("slided")?e(".container").animate({left:"0px"},500,function(){e("#search").attr("slided","false")}):(e("#channels").show(),e(".container").animate({left:"-180px"},500,function(){e("#search").attr("slided","true")}))}}),c.exports=PopupView}),define("douRadio/popup/1.0.0/share",[],function(a,b,c){var d={shareWeibo:function(a){url="http://douban.fm/?start="+a.sid+"g"+a.ssid+"g0&cid=0";var b=a.picture&&a.picture.replace(/mpic|spic/,"lpic"),c="分享"+a.artist+"的单曲《"+a.title+"》(来自@豆瓣FM)";window.open("http://service.weibo.com/share/share.php?url="+encodeURIComponent(url)+"&appkey=694135578&title="+encodeURIComponent(c)+"&pic="+encodeURIComponent(b)+"&language=zh-cn","_blank","width=615,height=505")},shareDouban:function(a){url="http://douban.fm/?start="+a.sid+"g"+a.ssid+"g0&cid=0";{var b=a.picture&&a.picture.replace(/mpic|spic/,"lpic");"分享"+a.artist+"的单曲《"+a.title+"》(来自@豆瓣FM)"}window.open("http://shuo.douban.com/!service/share?name="+encodeURIComponent(a.title)+"&href="+encodeURIComponent(url)+"&image="+encodeURIComponent(b)+"&desc=by小豆(http://goo.gl/iRxds)&apikey=0458f5fa0cd49e2a0d0ae1ee267dda7e&target_type=rec&target_action=0&object_kind=3043&object_id="+a.sid+"action_props="+encodeURIComponent('%7B"url"%3A "http://t.cn/zOxAHIV"%2C "title" "'+a.artist+"--"+a.title+'"%7D'),"_blank","width=615,height=505")}};c.exports=d}),define("douRadio/popup/1.0.0/view/channels",["backbone","$","underscore"],function(a,b,c){var d,e,f;d=a("backbone"),e=a("$"),f=a("underscore");var g=d.View.extend({el:"#channels",template:f.template(e("#t_channels").html()),templateFav:f.template(e("#t_favchannels").html()),initialize:function(){f.bindAll(this,"render","renderFav");var a=d.Model.extend({url:"https://api.douban.com/v2/fm/app_channels"});this.channels=new a;var b=d.Model.extend({url:"http://douban.fm/j/fav_channels"});this.favChannels=new b,this.favChannels.fetch({success:this.renderFav}),this.channels.fetch({success:this.render}),e("#currentChannel").html(localStorage.channelName),"disable"!=localStorage.channelCollected?e.get("http://douban.fm/j/explore/is_fav_channel?cid="+localStorage.channelId,function(a){e("#op-fav-channel").attr("cid",localStorage.channelId).attr("collected",a.data.res.is_fav)}):e("#op-fav-channel").attr("cid",localStorage.channelId).attr("collected","disable")},events:{"click .channel_item":"changeChannel","click #op-fav-channel":"favChannel","click .unfav":"unfavChannel"},render:function(){e("#total").html(this.template(this.channels.attributes))},renderFav:function(){e("#myFav").html(this.templateFav(this.favChannels.attributes))},changeChannel:function(a){e(".channel_item").removeClass("channel_item_selected");var b=e(a.target);b.addClass("channel_item_selected"),e("#currentChannel").html(b.attr("title")).attr("title",b.attr("title")),e("#op-fav-channel").attr("cid",b.attr("cid")).attr("collected",b.attr("collected")),e("#search").attr("title",b.attr("title")),this.player.set({playing:!0}),e("#control a").attr("class","button playing").hide(),e("#cover").removeClass("fadeout").addClass("rotating"),this.port.postMessage({type:"changeChannel",channel:{channelId:b.attr("cid"),channelName:b.attr("title"),channelCollected:b.attr("collected")}})},favChannel:function(){var a,b=e("#op-fav-channel");if("true"==b.attr("collected"))a="http://douban.fm/j/explore/unfav_channel?cid=";else{if("false"!=b.attr("collected"))return;a="http://douban.fm/j/explore/fav_channel?cid="}e.get(a+b.attr("cid"),function(a){if(1==a.status){var c="true"==b.attr("collected")?"false":"true";localStorage.channelCollected=c,e("#op-fav-channel").attr("collected","true"==b.attr("collected")?"false":"true")}})},unfavChannel:function(a){console.log("unfav");var b=e(a.target).parent();return e.get("http://douban.fm/j/explore/unfav_channel?cid="+b.attr("cid"),function(a){1==a.status&&(b.remove(),e("#op-fav-channel").attr("cid")==b.attr("cid")&&(e("#op-fav-channel").attr("collected","false"),localStorage.channelCollected="false"))}),!1}});c.exports=g});
